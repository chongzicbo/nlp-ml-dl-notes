# 1.HMM

## **1.1 定义、假设和应用**

（1）**HMM****的基本定义： HMM****是用于描述由隐藏的状态序列和显性的观测序列组合而成的双重随机过程。**在前面的例子中，城市天气就是隐藏的状态序列，这个序列是我们观测不到的。小明的活动就是观测序列，这个序列是我们能够观测到的。这两个序列都是随机序列。

（2）**HMM****的假设一：马尔科夫性假设。当前时刻的状态值，仅依赖于前一时刻的状态值，而不依赖于更早时刻的状态值。**每天的天气情况，会和前一天的天气情况有点关系。

（3）**HMM****的假设二：齐次性假设。状态转移概率矩阵与时间无关。即所有时刻共享同一个状态转移矩阵。**小明所在的城市，一年四季的天气情况都差不多。

（4）**HMM****的假设三：观测独立性假设。当前时刻的观察值，仅依赖于当前时刻的状态值。**小明每天会根据当天的天气情况，决定今天进行什么样的活动。

（5）**HMM****的应用目的：通过可观测到的数据，预测不可观测到的数据。**我们想通过小明的活动，猜测他所在城市的天气情况。

注一：马尔科夫性：随机过程中某事件的发生只取决于它的上一事件，是“无记忆”过程。

注二：HMM被广泛应用于标注任务。在标注任务中，状态值对应着标记，任务会给定观测序列，以预测其对应的标记序列。

注三：HMM属于生成模型，是有向图。



## 1.2 三个基本问题

在学习HMM的过程中，我们需要研究三个问题，它们分别是：

**概率计算问题**：给定模型参数和观测序列，计算该观测序列的概率。是后面两个问题的基础。

**学习训练问题**：给定观测序列，估计模型参数。

**解码预测问题**：给定模型参数和观测序列，求概率最大的状态序列。

这三个问题会贯穿我们学习HMM的整个过程，在接下来的三个小节，我们会分别学习这三个问题。



给出HMM模型的三个参数：A，B，π。

**A****：状态转移概率矩阵。**表征转移概率，维度为N*N。

**B****：观测概率矩阵。**表征发射概率，维度为N*M。

**π：初始状态概率向量**。维度为N*1。

λ=(A,B,π)，表示模型的所有参数。



## 1.3 **HMM的局限性**

马尔科夫性（有限历史性）：实际上在NLP领域的文本数据，很多词语都是长依赖的。

齐次性：序列不同位置的状态转移矩阵可能会有所变化，即位置信息会影响预测结果。

观测独立性：观测值和观测值（字与字）之间是有相关性的。

单向图：只与前序状态有关，和后续状态无关。在NLP任务中，上下文的信息都是必须的。

标记偏置LabelBias：若状态A能够向N种状态转移，状态B能够向M种状态转移。若N<<M，则预测序列更有可能选择状态A，因为A的转移概率较大。



# 2.CRF

## **2.1随机场的定义**

在这一小节，我们将会由泛化到特例，依次介绍随机场、马尔科夫随机场、条件随机场、线性链条件随机场的概念。

（1）随机场是一个图模型，是由若干个结点（随机变量）和边（依赖关系）组成的图模型，当给每一个结点按照某种分布随机赋予一个值之后，其全体就叫做随机场。

（2）马尔科夫随机场是随机场的特例，它假设随机场中任意一个结点的赋值，仅仅和它的邻结点的取值有关，和不相邻的结点的取值无关。用学术语言表示是：满足成对、局部或全局马尔科夫性。

（3）条件随机场CRF是马尔科夫随机场的特例，它假设模型中只有X（输入变量，观测值）和Y（输出变量，状态值）两种变量。输出变量Y构成马尔可夫随机场，输入变量X不具有马尔科夫性。

（4）线性链条件随机场，是状态序列是线性链的条件随机场。

*注1**：马尔科夫性：随机过程中某事件的发生只取决于它的上一事件，是“无记忆”过程。*

 

我们的应用领域是NLP，所以本文只针对线性链条件随机场进行讨论。

线性链条件随机场有以下性质：

（1）对于状态序列y，y的值只与相邻的y有关系，体现马尔科夫性。

（2）任意位置的y与所有位置的x都有关系。

（3）我们研究的线性链条件随机场，假设状态序列Y和观测序列X有相同的结构，但是实际上后文公式的推导，对于状态序列Y和观测序列X结构不同的条件随机场也适用。

（4）观测序列X是作为一个整体，去影响状态序列Y的值，而不是只影响相同或邻近位置（时刻）的Y。

（5）线性链条件随机场的示意图如下：

![img](https://mmbiz.qpic.cn/mmbiz_png/38pia2JScdQJx2ZhWib9pzVnKbySarZH5QxqsIGEDYIAzW02tk7yYW3zzbx8XNtvlfeBlLuEQzvpGDOyBbamaLiag/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)





注二：李航老师的《统计学习方法》里，使用了两种示意图来描述线性链条件随机场，一种是上文所呈现的，这张图更能够体现性质（4），另一种如下图，关注点是X和Y同结构：



 

![img](https://mmbiz.qpic.cn/mmbiz_png/38pia2JScdQJx2ZhWib9pzVnKbySarZH5Qgo1HCJtbFMJh7j2EasSibibL9EbqGHnCia0YaYBOLhokib6wqc6ZkUNU0w/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)



## **2.2CRF的应用**

线性链条件随机场CRF是在给定一组随机变量X（观测值）的条件下，获取另一组随机变量Y（状态值）的条件概率分布模型。在NLP领域，线性链条件随机场被广泛用于标注任务（NER、分词等）。

 

## **2.3 构建CRF的思路（重要）**

我们先给出构建CRF模型的核心思路，现在暂不需要读懂这些思路的本质思想，但是我们要带着这些思路去阅读后续的内容。

（1）CRF是**判别模型**，是黑箱模型，不关心概率分布情况，只关心输出结果。

（2）CRF最重要的工作，是提取特征，**构建特征函数**。

（3）CRF使用特征函数给不同的标注网络**打分**，根据分数选出可能性最高的标注网络。

（4）CRF模型的计算过程，使用的是以e为底的指数。这个建模思路和深度学习输出层的softmax是一致的。先计算各个可能情况的分数，再进行**softmax****归一化操作**。

 

## **2.4 CRF的优缺点（重要）**

### **2.4.1CRF相对于HMM的优点**

（1）规避了马尔科夫性（有限历史性），能够获取长文本的远距离依赖的信息。

（2）规避了齐次性，模型能够获取序列的位置信息，并且序列的位置信息会影响预测出的状态序列。

（3）规避了观测独立性，观测值之间的相关性信息能够被提取。

（4）不是单向图，而是无向图，能够充分提取上下文信息作为特征。

（5）改善了标记偏置LabelBias问题，因为CRF相对于HMM能够更多地获取序列的全局概率信息。

（6）CRF的思路是利用多个特征，对状态序列进行预测。HMM的表现形式使他无法使用多个复杂特征。

 

### **2.4.2条件随机场CRF的缺点**

（1）CRF训练代价大、复杂度高。

（2）每个特征的权重固定，特征函数只有0和1两个取值。

（3）模型过于复杂，在海量数据的情况下，业界多用神经网络。

（4）需要人为构造特征函数，特征工程对CRF模型的影响很大。

（5）转移特征函数的自变量只涉及两个相邻位置，而CRF定义中的马尔科夫性，应该涉及三个相邻位置。

 

### **2.4.3标记偏置LabelBias**

在HMM中的体现：对于某一时刻的任一状态，当它向后一时进行状态刻转移时，会对转移到的所有状态的概率做归一化，这是一种局部的归一化。即使某个转移概率特别高，其转移概率也不超过1。即使某个转移概率特别低，如果其它几个转移概率同样低，那么归一化后的转移概率也不会接近0。

在CRF被规避的原因：CRF使用了全局的归一化。在进行归一化之前，使用分数来标记状态路径的可能性大小。待所有路径所有位置的分数都计算完成后，再进行归一化。某些某个状态转移的子路径有很高的分数，会对整条路径的概率产生很大的影响。



# 3.HMM和CRF的区别

1.HMM是生成模型，CRF是判别模型

2.HMM是概率有向图，CRF是概率无向图

3.HMM求解过程可能是局部最优，CRF可以全局最优

4.CRF概率归一化较合理，HMM则会导致label bias 问题



> [条件随机场（CRF）和隐马尔科夫模型（HMM）最大区别在哪里？CRF的全局最优体现在哪里？](https://www.zhihu.com/question/53458773)
> [史上最详细最容易理解的HMM文章](https://link.zhihu.com/?target=http%3A//www.360doc.com/content/13/0226/14/11619026_268005483.shtml)
> [如何用简单易懂的例子解释条件随机场（CRF）模型？它和HMM有什么区别？](https://www.zhihu.com/question/35866596)